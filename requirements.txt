import pandas as pd

# Charger les données
data = pd.read_csv("data_with_selected_columns.csv")

# Convertir la colonne feature_time en type datetime si elle ne l'est pas déjà
data['feature_time'] = pd.to_datetime(data['feature_time'])

# Réassigner les valeurs des features existantes
data['day_of_week'] = data['feature_time'].dt.dayofweek
data['month'] = data['feature_time'].dt.month
data['is_weekend'] = (data['day_of_week'] >= 5).astype(int)

# Calculer la fréquence d'accès par jour
access_frequency = data.groupby(['user', data['feature_time'].dt.date])['feature_time'].count().reset_index()
access_frequency.columns = ['user', 'feature_time', 'access_frequency']
data = pd.merge(data, access_frequency, on=['user', 'feature_time'], how='left')

# Calculer la fréquence d'accès par mois
monthly_access_frequency = data.groupby(['user', data['feature_time'].dt.to_period('M')])['feature_time'].count().reset_index()
monthly_access_frequency.columns = ['user', 'month', 'monthly_access_frequency']
data = pd.merge(data, monthly_access_frequency, on=['user', 'month'], how='left')

# Calculer la fréquence d'accès par jour de la semaine
weekly_access_frequency = data.groupby(['user', data['feature_time'].dt.dayofweek])['feature_time'].count().reset_index()
weekly_access_frequency.columns = ['user', 'day_of_week', 'weekly_access_frequency']
data = pd.merge(data, weekly_access_frequency, on=['user', 'day_of_week'], how='left')

# Afficher les premières lignes du dataset avec les nouvelles features
print(data.head())
